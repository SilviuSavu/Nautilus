# Redis Neural-GPU Bus Configuration
# Optimized for quantum engines and advanced physics simulations with M4 Max acceleration

# Basic Configuration
port 6379
bind 0.0.0.0
protected-mode no

# Memory Management - Quantum/Physics Optimized
maxmemory 16gb
maxmemory-policy allkeys-lru
maxmemory-samples 10

# Persistence - Balanced for quantum algorithms
save 300 1      # Save if at least 1 key changed in 300 seconds
save 60 100     # Save if at least 100 keys changed in 60 seconds  
save 10 10000   # Save if at least 10000 keys changed in 10 seconds
stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes

# AOF Persistence for quantum state reliability  
appendonly yes
appendfilename "appendonly.aof"
appendfsync everysec
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# Network Configuration - Optimized for Neural Engine + Metal GPU coordination
tcp-keepalive 120
tcp-backlog 511
timeout 0

# Client Configuration - Quantum engines support
maxclients 25000
client-query-buffer-limit 32mb
proto-max-bulk-len 512mb

# Advanced Configuration
hz 50                    # Background task frequency (balanced)
tcp-nodelay yes         # Low latency for quantum computations  
tcp-backlog 511
databases 16            # Multiple databases for different quantum algorithms

# Memory Usage Optimization for M4 Max
hash-max-ziplist-entries 512
hash-max-ziplist-value 64
list-max-ziplist-size -2
list-compress-depth 0
set-max-intset-entries 512
zset-max-ziplist-entries 128
zset-max-ziplist-value 64

# Slow Log Configuration
slowlog-log-slower-than 10000  # 10ms for quantum operations
slowlog-max-len 128

# Latency Monitoring
latency-monitor-threshold 100  # 100ms threshold

# Kernel Configuration
overcommit-memory 1

# Threading (Redis 6.x/7.x optimization)
io-threads 4               # M4 Max optimization
io-threads-do-reads yes    # Enable threaded I/O for reads

# Module Configuration (if quantum modules are loaded)
# module load /path/to/quantum-redis-module.so

# Security (basic)
# requirepass your_secure_password_here

# Logging
loglevel notice
logfile "/var/log/redis/neural-gpu-bus.log"
syslog-enabled yes
syslog-ident neural-gpu-redis
syslog-facility local0

# Performance Tuning for Quantum Workloads
rdb-save-incremental-fsync yes
aof-rewrite-incremental-fsync yes

# Client Buffer Limits
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# Memory Defragmentation (Redis 4.0+)
activedefrag yes
active-defrag-ignore-bytes 100mb
active-defrag-threshold-lower 10
active-defrag-threshold-upper 100
active-defrag-cycle-min 5
active-defrag-cycle-max 75