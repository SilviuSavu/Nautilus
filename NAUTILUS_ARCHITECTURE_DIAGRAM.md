# Nautilus Trading Platform - Comprehensive Architecture Diagram

## System Overview
Professional-grade trading platform with sophisticated risk management, backtesting capabilities, and real-time market data processing.

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                          NAUTILUS TRADING PLATFORM                                                     │
│                                     Multi-Engine Trading Architecture                                                  │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                            FRONTEND LAYER                                                              │
│  ┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────┐   │
│  │                                     React Frontend (Port 3000)                                                │   │
│  │  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐         │   │
│  │  │  IB Dashboard   │ │ Performance     │ │ Strategy Mgmt   │ │ Risk Dashboard  │ │ Portfolio Viz   │         │   │
│  │  │  - Live Data    │ │ - Analytics     │ │ - Builder       │ │ - Risk Metrics  │ │ - Asset Alloc   │         │   │
│  │  │  - Order Entry  │ │ - Attribution   │ │ - Lifecycle     │ │ - Position Mon  │ │ - Performance   │         │   │
│  │  │  - Watchlists   │ │ - Backtesting   │ │ - Deployment    │ │ - Alerts        │ │ - Correlations  │         │   │
│  │  └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘         │   │
│  └──────────────────────────────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                     ↕ HTTP/WS                                                         │
│  ┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────┐   │
│  │                                     NGINX Reverse Proxy (Port 80)                                             │   │
│  │  - Load Balancing  - SSL Termination  - Request Routing  - Static Content                                    │   │
│  └──────────────────────────────────────────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                            API GATEWAY LAYER                                                           │
│  ┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────┐   │
│  │                                  FastAPI Backend (Port 8001)                                                  │   │
│  │  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐         │   │
│  │  │ Engine Routes   │ │ Strategy Routes │ │ Risk Routes     │ │ Portfolio Routes│ │ IB Routes       │         │   │
│  │  │ /nautilus/*     │ │ /strategies/*   │ │ /risk/*         │ │ /portfolio/*    │ │ /ib/*           │         │   │
│  │  └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘         │   │
│  │  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐         │   │
│  │  │ Backtest Routes │ │ Factor Routes   │ │ Performance Rt  │ │ Data Catalog Rt │ │ Monitoring Rt   │         │   │
│  │  │ /backtest/*     │ │ /factor-engine/*│ │ /performance/*  │ │ /data-catalog/* │ │ /system-mon/*   │         │   │
│  │  └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘         │   │
│  │  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐                                                │   │
│  │  │ Auth Middleware │ │ Rate Limiter    │ │ Error Handler   │                                                │   │
│  │  │ - JWT Security  │ │ - API Limits    │ │ - Exception Mgmt│                                                │   │
│  │  └─────────────────┘ └─────────────────┘ └─────────────────┘                                                │   │
│  └──────────────────────────────────────────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        CORE ENGINE LAYER                                                               │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                  NAUTILUSTRADER ENGINE SERVICE                                                    │ │
│  │  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │ │
│  │  │                         Docker Container: nautilus-engine (Port 8002)                                       │ │ │
│  │  │  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐                           │ │ │
│  │  │  │  Live Engine    │ │ Backtest Engine │ │ Data Catalog    │ │ Portfolio Mgmt  │                           │ │ │
│  │  │  │  - Trading      │ │ - Historical    │ │ - Parquet Data  │ │ - Asset Alloc   │                           │ │ │
│  │  │  │  - Risk Mgmt    │ │ - Strategy Test │ │ - Multi-venue   │ │ - Performance   │                           │ │ │
│  │  │  │  - Execution    │ │ - Optimization  │ │ - Time Series   │ │ - Correlations  │                           │ │ │
│  │  │  └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘                           │ │ │
│  │  │  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │ │ │
│  │  │  │                                  ENGINE STATES                                                            │ │ │ │
│  │  │  │  STOPPED → STARTING → RUNNING → STOPPING → ERROR                                                       │ │ │ │
│  │  │  │  - Container lifecycle management  - Health monitoring  - Resource tracking                           │ │ │ │
│  │  │  └─────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │ │ │
│  │  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                       │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                  STRATEGY EXECUTION ENGINE                                                       │ │
│  │  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐           │ │
│  │  │ Strategy Deploy │ │ Lifecycle Mgmt  │ │ Risk Controls   │ │ Performance Mon │ │ Error Handling  │           │ │
│  │  │ - Start/Stop    │ │ - State Mgmt    │ │ - Position Lim  │ │ - Real-time     │ │ - Recovery      │           │ │
│  │  │ - Config Mgmt   │ │ - Health Check  │ │ - Stop Loss     │ │ - Tracking      │ │ - Rollback      │           │ │
│  │  └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘           │ │
│  │  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │ │
│  │  │                               STRATEGY STATES                                                                │ │ │
│  │  │  STOPPED → STARTING → RUNNING → PAUSED → STOPPING → ERROR                                                 │ │ │
│  │  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                       │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                     FACTOR ENGINE SERVICE                                                        │ │
│  │  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐           │ │
│  │  │ Toraniko Engine │ │ Momentum Factor │ │ Value Factor    │ │ Size Factor     │ │ Risk Model      │           │ │
│  │  │ - Multi-factor  │ │ - 252-day trail │ │ - Fundamental   │ │ - Market Cap    │ │ - Covariance    │           │ │
│  │  │ - Equity Risk   │ │ - Winsorization │ │ - P/B, P/S, P/CF│ │ - Size scoring  │ │ - Factor Loads  │           │ │
│  │  │ - Integration   │ │ - Scoring       │ │ - Analysis      │ │ - Analysis      │ │ - Specific Risk │           │ │
│  │  └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘           │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                      MESSAGE BUS & COMMUNICATION                                                       │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                    REDIS MESSAGE BUS                                                             │ │
│  │  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │ │
│  │  │                                REDIS STREAMS ARCHITECTURE                                                    │ │ │
│  │  │                                                                                                               │ │ │
│  │  │  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐   │ │ │
│  │  │  │  Stream Key: nautilus-streams                                                                         │   │ │ │
│  │  │  │  Consumer Group: dashboard-group                                                                      │   │ │ │
│  │  │  │  Consumer Name: dashboard-consumer                                                                    │   │ │ │
│  │  │  │                                                                                                       │   │ │ │
│  │  │  │  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐                    │   │ │ │
│  │  │  │  │ Market Data     │ │ Strategy Events │ │ System Events   │ │ WebSocket Bcast │                    │   │ │ │
│  │  │  │  │ - Real-time     │ │ - State Changes │ │ - Health Checks │ │ - Client Updates│                    │   │ │ │
│  │  │  │  │ - Order Updates │ │ - Performance   │ │ - Error Reports │ │ - Event Routing │                    │   │ │ │
│  │  │  │  └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘                    │   │ │ │
│  │  │  └─────────────────────────────────────────────────────────────────────────────────────────────────────┘   │ │ │
│  │  │                                                                                                               │ │ │
│  │  │  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐   │ │ │
│  │  │  │                                CONNECTION MANAGEMENT                                                  │   │ │ │
│  │  │  │  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐                    │   │ │ │
│  │  │  │  │ Connection Pool │ │ Auto Reconnect  │ │ Health Monitor  │ │ Error Handling  │                    │   │ │ │
│  │  │  │  │ - Connection Mgmt│ │ - Exponential   │ │ - 30s Intervals │ │ - Graceful Fail │                    │   │ │ │
│  │  │  │  │ - Keep Alive    │ │ - Max 10 Attempts│ │ - Status Check  │ │ - Circuit Break │                    │   │ │ │
│  │  │  │  └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘                    │   │ │ │
│  │  │  └─────────────────────────────────────────────────────────────────────────────────────────────────────┘   │ │ │
│  │  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │ │
│  │                                                                                                                   │ │
│  │  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │ │
│  │  │                                   CONNECTION STATES                                                          │ │ │
│  │  │  DISCONNECTED → CONNECTING → CONNECTED → RECONNECTING → ERROR                                              │ │ │
│  │  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                         CACHING & DATA LAYER                                                           │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                    REDIS CACHE LAYER (DB 1)                                                     │ │
│  │  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │ │
│  │  │                                   DATA STRUCTURES & TTL                                                      │ │ │
│  │  │                                                                                                               │ │ │
│  │  │  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐       │ │ │
│  │  │  │ Tick Data       │ │ Quote Data      │ │ OHLCV Bars      │ │ Order Books     │ │ Latest Data     │       │ │ │
│  │  │  │ TTL: 5 mins     │ │ TTL: 5 mins     │ │ TTL: 1 hour     │ │ TTL: 1 min      │ │ TTL: 1 hour     │       │ │ │
│  │  │  │ Keep: 1000 ticks│ │ Keep: 500 quotes│ │ Keep: 200 bars  │ │ Real-time       │ │ Fast Retrieval  │       │ │ │
│  │  │  └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘       │ │ │
│  │  │                                                                                                               │ │ │
│  │  │  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐   │ │ │
│  │  │  │                                   KEY PATTERNS                                                        │   │ │ │
│  │  │  │  market:tick:{venue}:{instrument}      │  latest:tick:{venue}:{instrument}                         │   │ │ │
│  │  │  │  market:quote:{venue}:{instrument}     │  latest:quote:{venue}:{instrument}                        │   │ │ │
│  │  │  │  market:bar:{venue}:{instrument}:{tf}  │  latest:bar:{venue}:{instrument}:{tf}                     │   │ │ │
│  │  │  │  market:orderbook:{venue}:{instrument} │  instruments:{venue}                                      │   │ │ │
│  │  │  └─────────────────────────────────────────────────────────────────────────────────────────────────────┘   │ │ │
│  │  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                       │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                               POSTGRESQL + TIMESCALEDB                                                           │ │
│  │  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐           │ │
│  │  │ Market Data     │ │ Trade History   │ │ Strategy Data   │ │ Portfolio Data  │ │ User Data       │           │ │
│  │  │ - Time Series   │ │ - Executions    │ │ - Configs       │ │ - Positions     │ │ - Authentication│           │ │
│  │  │ - Nanosec Prec  │ │ - Orders        │ │ - Performance   │ │ - Allocations   │ │ - Authorization │           │ │
│  │  │ - Compression   │ │ - Fills         │ │ - Metrics       │ │ - Risk Metrics  │ │ - Sessions      │           │ │
│  │  └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘           │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        SERVICE ECOSYSTEM                                                               │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                        DATA SERVICES                                                             │ │
│  │  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐           │ │
│  │  │ IB Integration  │ │ Historical Data │ │ Market Data     │ │ Data Backfill   │ │ Parquet Export  │           │ │
│  │  │ - Gateway Conn  │ │ - Database Ops  │ │ - Real-time     │ │ - Bulk Loading  │ │ - Analytics     │           │ │
│  │  │ - Primary Source│ │ - Time Series   │ │ - Processing    │ │ - Status Track  │ │ - Data Export   │           │ │
│  │  │ - Multi-asset   │ │ - Caching       │ │ - Normalization │ │ - Stop Controls │ │ - File Mgmt     │           │ │
│  │  └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘           │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                       │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                      TRADING SERVICES                                                            │ │
│  │  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐           │ │
│  │  │ Portfolio Svc   │ │ Trade History   │ │ Exchange Svc    │ │ Risk Service    │ │ Order Mgmt      │           │ │
│  │  │ - Portfolio Mgmt│ │ - Trade Exec    │ │ - Multi-venue   │ │ - Risk Mgmt     │ │ - Order Routing │           │ │
│  │  │ - Tracking      │ │ - History Mgmt  │ │ - Coordination  │ │ - Position Mon  │ │ - Execution     │           │ │
│  │  │ - Performance   │ │ - Analytics     │ │ - Venue Router  │ │ - Alert System  │ │ - Lifecycle     │           │ │
│  │  └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘           │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                       │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                      SYSTEM SERVICES                                                             │ │
│  │  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐           │ │
│  │  │ Monitoring Svc  │ │ Deployment Svc  │ │ Auth Service    │ │ WebSocket Svc   │ │ Rate Limiter    │           │ │
│  │  │ - Health Checks │ │ - Strategy Deploy│ │ - JWT Security  │ │ - Real-time     │ │ - API Throttle  │           │ │
│  │  │ - Performance   │ │ - Automation    │ │ - User Mgmt     │ │ - Event Stream  │ │ - Protection    │           │ │
│  │  │ - Alerting      │ │ - Rollback      │ │ - Sessions      │ │ - Connection Mgmt│ │ - Rate Control  │           │ │
│  │  └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘           │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                     EXTERNAL INTEGRATIONS                                                              │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                 INTERACTIVE BROKERS GATEWAY                                                      │ │
│  │  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐           │ │
│  │  │ Market Data     │ │ Order Execution │ │ Account Data    │ │ Historical Data │ │ Risk Management │           │ │
│  │  │ - Real-time     │ │ - Order Entry   │ │ - Positions     │ │ - Backfill      │ │ - Margin Check  │           │ │
│  │  │ - Level 1/2     │ │ - Fills         │ │ - Balances      │ │ - Multi-asset   │ │ - Compliance    │           │ │
│  │  │ - Multi-venue   │ │ - Modifications │ │ - Portfolio     │ │ - Time Series   │ │ - Limits        │           │ │
│  │  └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘           │ │
│  │  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │ │
│  │  │                            IB Gateway Configuration                                                          │ │ │
│  │  │  Host: host.docker.internal  │  Port: 4002  │  Client ID: Dynamic  │  Connection: TCP                   │ │ │
│  │  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                     DOCKER CONTAINERIZATION                                                            │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                    CONTAINER NETWORK: nautilus-network                                          │ │
│  │                                                                                                                   │ │
│  │  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐           │ │
│  │  │ nautilus-frontend│ │ nautilus-backend│ │ nautilus-engine │ │ nautilus-redis  │ │ nautilus-postgres│           │ │
│  │  │ Port: 3000      │ │ Port: 8001      │ │ Port: 8002      │ │ Port: 6379      │ │ Port: 5432      │           │ │
│  │  │ - React App     │ │ - FastAPI       │ │ - NautilusTrader│ │ - Redis 7       │ │ - TimescaleDB   │           │ │
│  │  │ - Vite Build    │ │ - Python 3.13   │ │ - Trading Engine│ │ - Streams/Cache │ │ - PostgreSQL 15 │           │ │
│  │  └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘           │ │
│  │                                                                                                                   │ │
│  │  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │ │
│  │  │                                   DOCKER VOLUMES                                                             │ │ │
│  │  │  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐       │ │ │
│  │  │  │ engine_data     │ │ engine_cache    │ │ engine_config   │ │ engine_results  │ │ postgres_data   │       │ │ │
│  │  │  │ - Market Data   │ │ - Cache DB      │ │ - Configurations│ │ - Backtest Out  │ │ - Database      │       │ │ │
│  │  │  │ - Strategies    │ │ - Session Data  │ │ - Strategy Conf │ │ - Performance   │ │ - Persistence   │       │ │ │
│  │  │  └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘       │ │ │
│  │  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │ │
│  │                                                                                                                   │ │
│  │  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │ │
│  │  │                                HEALTH CHECKS & MONITORING                                                    │ │ │
│  │  │  - Container Health Checks  - Resource Monitoring  - Auto-restart Policies  - Log Aggregation              │ │ │
│  │  │  - Service Discovery       - Load Balancing       - Failure Recovery       - Performance Metrics          │ │ │
│  │  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                          DATA FLOW DIAGRAM                                                             │
│                                                                                                                         │
│  Market Data Flow:                                                                                                      │
│  IB Gateway → IB Integration Service → Data Normalizer → Redis Cache → MessageBus → Frontend                          │
│                                              ↓                                                                         │
│                                       PostgreSQL/TimescaleDB                                                           │
│                                                                                                                         │
│  Trading Flow:                                                                                                          │
│  Frontend → FastAPI → Strategy Engine → NautilusTrader → IB Gateway                                                    │
│      ↓          ↓            ↓              ↓                                                                          │
│  WebSocket  Risk Service  MessageBus     Trade DB                                                                      │
│                                                                                                                         │
│  Factor Analysis Flow:                                                                                                  │
│  Market Data → Factor Engine → Toraniko → Risk Model → Portfolio Optimization                                          │
│                                                                                                                         │
│  Backtest Flow:                                                                                                         │
│  Strategy Config → NautilusTrader Engine → Historical Data → Results → Performance Analysis                            │
│                                                                                                                         │
│  Real-time Communication:                                                                                              │
│  MessageBus (Redis Streams) ↔ WebSocket Service ↔ Frontend (Live Updates)                                             │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        SECURITY & PERFORMANCE                                                          │
│                                                                                                                         │
│  Authentication & Authorization:                                                                                        │
│  - JWT-based authentication with secure token management                                                               │
│  - Role-based access control (RBAC) for different user types                                                           │
│  - API rate limiting and throttling for protection                                                                     │
│  - Secure session management with automatic expiration                                                                 │
│                                                                                                                         │
│  Performance Optimizations:                                                                                            │
│  - Redis caching with TTL policies for fast data retrieval                                                             │
│  - TimescaleDB for efficient time-series data storage                                                                  │
│  - Asynchronous processing with FastAPI and asyncio                                                                    │
│  - Connection pooling and keep-alive for database connections                                                          │
│  - Message queuing with Redis Streams for reliable delivery                                                            │
│                                                                                                                         │
│  Reliability & Monitoring:                                                                                             │
│  - Health checks for all services with automatic recovery                                                              │
│  - Circuit breakers for external service dependencies                                                                  │
│  - Comprehensive logging and error tracking                                                                            │
│  - Resource usage monitoring and alerting                                                                              │
│  - Graceful degradation and fallback mechanisms                                                                        │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘